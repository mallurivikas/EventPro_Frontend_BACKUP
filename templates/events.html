{% extends "base.html" %}

{% block title %}Events Created - EventPro{% endblock %}

{% block page_title %}Events Created{% endblock %}

{% block content %}
<!-- Events Overview Stats -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600">Total Events</p>
                <p class="text-2xl font-bold text-gray-900 mt-1" id="total-events">0</p>
                <p class="text-green-600 text-sm mt-1">All time</p>
            </div>
            <div class="p-3 rounded-lg bg-blue-50">
                <i data-lucide="calendar" class="w-6 h-6 text-blue-600"></i>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600">Live Events</p>
                <p class="text-2xl font-bold text-gray-900 mt-1" id="live-events">0</p>
                <p class="text-green-600 text-sm mt-1">ðŸ”´ Active now</p>
            </div>
            <div class="p-3 rounded-lg bg-green-50">
                <i data-lucide="activity" class="w-6 h-6 text-green-600"></i>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600">Completed Events</p>
                <p class="text-2xl font-bold text-gray-900 mt-1" id="completed-events">0</p>
                <p class="text-blue-600 text-sm mt-1">Finished</p>
            </div>
            <div class="p-3 rounded-lg bg-purple-50">
                <i data-lucide="check-circle" class="w-6 h-6 text-purple-600"></i>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600">Total Attendees</p>
                <p class="text-2xl font-bold text-gray-900 mt-1" id="total-attendees">0</p>
                <p class="text-orange-600 text-sm mt-1">Across all events</p>
            </div>
            <div class="p-3 rounded-lg bg-orange-50">
                <i data-lucide="users" class="w-6 h-6 text-orange-600"></i>
            </div>
        </div>
    </div>
</div>

<!-- Create New Event Button -->
<div class="flex justify-between items-center mb-6">
    <h2 class="text-xl font-semibold text-gray-900">Your Events</h2>
    <a href="/create-event" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">
        <i data-lucide="plus" class="w-4 h-4"></i>
        <span>Create New Event</span>
    </a>
</div>

<!-- Events Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="events-grid">
    <!-- Events will be populated here -->
</div>

<!-- Empty State (shown when no events) -->
<div id="empty-state" class="text-center py-12 hidden">
    <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <i data-lucide="calendar-plus" class="w-12 h-12 text-gray-400"></i>
    </div>
    <h3 class="text-xl font-semibold text-gray-900 mb-2">No Events Created Yet</h3>
    <p class="text-gray-600 mb-6 max-w-md mx-auto">
        Get started by creating your first event. You'll be able to track analytics, engagement, and gather feedback.
    </p>
    <a href="/create-event" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg inline-flex items-center space-x-2 transition-colors">
        <i data-lucide="plus" class="w-5 h-5"></i>
        <span>Create Your First Event</span>
    </a>
</div>
{% endblock %}

{% block scripts %}
<script>
    let allEvents = [];

    // Load events data
    async function loadEvents() {
        try {
            const response = await fetch('/api/events');
            const data = await response.json();
            allEvents = data.events || [];
            
            updateStats();
            displayEvents();
            
        } catch (error) {
            console.error('Error loading events:', error);
        }
    }

    function updateStats() {
        const totalEvents = allEvents.length;
        const liveEvents = allEvents.filter(e => e.status === 'live').length;
        const completedEvents = allEvents.filter(e => e.status === 'completed').length;
        const totalAttendees = allEvents.reduce((sum, e) => sum + (e.attendees || 0), 0);

        document.getElementById('total-events').textContent = totalEvents;
        document.getElementById('live-events').textContent = liveEvents;
        document.getElementById('completed-events').textContent = completedEvents;
        document.getElementById('total-attendees').textContent = totalAttendees.toLocaleString();
    }

    function displayEvents() {
        const eventsGrid = document.getElementById('events-grid');
        const emptyState = document.getElementById('empty-state');

        if (allEvents.length === 0) {
            eventsGrid.classList.add('hidden');
            emptyState.classList.remove('hidden');
            return;
        }

        eventsGrid.classList.remove('hidden');
        emptyState.classList.add('hidden');
        eventsGrid.innerHTML = '';

        allEvents.forEach(event => {
            const eventCard = createEventCard(event);
            eventsGrid.appendChild(eventCard);
        });
    }

    function createEventCard(event) {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow cursor-pointer';
        
        const statusColors = {
            'live': 'bg-green-100 text-green-800',
            'completed': 'bg-blue-100 text-blue-800',
            'upcoming': 'bg-yellow-100 text-yellow-800'
        };

        const statusColor = statusColors[event.status] || statusColors['upcoming'];

        card.innerHTML = `
            <div class="flex items-start justify-between mb-4">
                <div class="flex-1">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">${event.title}</h3>
                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">${event.description || 'No description available'}</p>
                </div>
                <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColor} ml-2">
                    ${event.status}
                </span>
            </div>
            
            <div class="space-y-2 mb-4">
                <div class="flex items-center text-sm text-gray-600">
                    <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                    <span>${event.date} at ${event.time}</span>
                </div>
                <div class="flex items-center text-sm text-gray-600">
                    <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                    <span>${event.location}</span>
                </div>
                <div class="flex items-center text-sm text-gray-600">
                    <i data-lucide="users" class="w-4 h-4 mr-2"></i>
                    <span>${event.attendees || 0} / ${event.capacity} attendees</span>
                </div>
                <div class="flex items-center text-sm text-gray-600">
                    <i data-lucide="dollar-sign" class="w-4 h-4 mr-2"></i>
                    <span>${event.ticketPrice == 0 ? 'Free' : 'IDR ' + event.ticketPrice.toLocaleString()}</span>
                </div>
            </div>
            
            <div class="flex space-x-2">
                <button onclick="viewAnalytics(${event.id})" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                    View Analytics
                </button>
                <button onclick="editEvent(${event.id})" class="px-3 py-2 border border-gray-200 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors">
                    <i data-lucide="edit" class="w-4 h-4"></i>
                </button>
                <button onclick="deleteEvent(${event.id})" class="px-3 py-2 border border-gray-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        `;

        return card;
    }

    function viewAnalytics(eventId) {
        // Redirect to pre-event analytics as default
        window.location.href = `/events/${eventId}/pre-event`;
    }

    function editEvent(eventId) {
        // For now, just show alert. In production, redirect to edit page
        alert(`Edit event ${eventId} - Feature coming soon!`);
    }

    function deleteEvent(eventId) {
        if (confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
            // Filter out the deleted event
            allEvents = allEvents.filter(e => e.id !== eventId);
            updateStats();
            displayEvents();
            
            // In production, make API call to delete event
            alert('Event deleted successfully!');
        }
    }

    // Load data when page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadEvents();
        // Re-initialize Lucide icons after DOM manipulation
        setTimeout(() => lucide.createIcons(), 100);
    });
</script>
{% endblock %}